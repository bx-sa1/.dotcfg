#!/bin/bash
power_supply_folder="/sys/class/power_supply/$1"
status="cat $power_supply_folder/status"
charge="cat $power_supply_folder/capacity"
charge_levels=(40 20 10 5)

notify() {
    notify-send -u $1 -t 2000 -a acpi "Battery" "$2"
    echo "Battery: $2"
}

old_charge=$(eval $charge)
old_status=$(eval $status)
while true
do
    current_charge=$(eval $charge)
    current_status=$(eval $status)

    for level in "$charge_levels"
    do
        if [[ $old_charge -ne $current_charge && \
            $current_charge -eq $level ]]
        then
            notify normal "$current_status, $current_charge%"
            old_charge=$current_charge
            break
        fi
    done

    if [[ $current_status != $old_status ]]
    then
        case $current_status 
        in
            "Not charging" | "Full")
                notify normal "Battery fully charged."
                ;;
            "Discharging")
                notify normal "Battery discharged."
                ;;
            "Charging")
                notify normal "Battery charging..."
                ;;
            *)
                notify urgent "Unhandled: $current_status"
                ;;
        esac
        old_status=$current_status
    fi


    sleep 10
done
